<ion-header [translucent]="true">
  <ion-toolbar>
    <app-back-button slot="start"></app-back-button>
    <ion-title>Админка</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content pulling-icon="chevronDownCircleOutline" pulling-text="Потяните для обновления"
      refreshing-spinner="circles" refreshing-text="Обновление...">
    </ion-refresher-content>
  </ion-refresher>

  <div class="admin-users-list">
    <div class="admin-header">
      <h2>Управление пользователями</h2>
      <div class="admin-header-content">
        <p>Всего пользователей: {{ users.length }}</p>
      </div>
    </div>

    <!-- Индикатор загрузки -->
    <div *ngIf="isLoading" class="loading-container">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Загрузка пользователей...</p>
    </div>

    <!-- Сообщение об ошибке -->
    <div *ngIf="errorMessage" class="error-message">
      <ion-icon name="alert-circle-outline"></ion-icon>
      <p>{{ errorMessage }}</p>
    </div>

    <!-- Список пользователей -->
    <div *ngIf="!isLoading && !errorMessage" class="users-grid">
      <div *ngFor="let user of users" class="user-card">
        <div class="user-avatar">

          <ion-avatar *ngIf="user.avatarId">
            <img [src]="user.avatarId | authImage : user.authService" alt="avatar" (error)="onImageError($event, user)"
              (load)="onImageLoad($event, user)" />
          </ion-avatar>
          <div *ngIf="!user.avatarId || user.avatarLoadError" class="user-avatar-placeholder">
            <ion-icon name="person-circle-outline"></ion-icon>
          </div>
        </div>
        <div class="user-info">
          <h3>{{ getUserDisplayName(user) }}</h3>
          <p class="user-email">{{ user.email }}</p>
          <div class="user-roles">
            <span *ngFor="let role of getRoleNames(user)" class="role-badge">{{ role }}</span>
          </div>
        </div>
        <div class="user-actions">
          <ion-button size="small" fill="outline" (click)="editRoles(user)">
            Роли
          </ion-button>
          <ion-button size="small" fill="clear" color="danger" (click)="removeUser(user.id)">
            <ion-icon name="trash-outline"></ion-icon>
          </ion-button>
        </div>
      </div>
    </div>

    <!-- Пустое состояние -->
    <div *ngIf="!isLoading && !errorMessage && users.length === 0" class="empty-state">
      <ion-icon name="people-outline"></ion-icon>
      <p>Пользователи не найдены</p>
    </div>
  </div>
</ion-content>